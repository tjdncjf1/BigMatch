<!DOCTYPE html>
<html>
<!-- 
	Program     : register.html
	Date        : 2016-04-07
	Description : 대전을 등록하는 페이지에서 지도로 위치를 등록할 수 있는 지도 소스
	Modify      : 임현우
	History     : - 2016-04-07 작성자 : 임현우
					지도에서 현재 등록된 매치리스트를 볼수 있게 함. 
				  - 2016-04-08 작성자 : 임현우
				  	현재위치 geoLocation 추가
				  	미완성 부분 : 3구 4구 포켓볼 전체의 핀정보를 페이지마다 불러와야함
				  	
    -->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>대전 리스트(맵)</title>
	
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
	<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
	
	
	    <style>
    .map_wrap {
    	position:		fixed;
    	width	:		100%;
    	height	:		80%;
    }
    .title {
    	font-weight:	bold;
    	display :		block;
    }
    .hAddr {
    	position:		absolute;
    	left :			10px;
    	top:			10px;
    	border-radius:	2px;
    	background:		#fff;
    	background:		rgba(255,255,255,0.8);
    	z-index:		1;
    	padding:		5px;
    }
    .rdList {
    	position:		absolute;
    	Right:			10px;
    	bottom:			30px;
    	border-radius:	2px;
    	background:		#fff;
    	background:		rgba(255,255,255,0.8);
    	z-index:		1;
    	padding:		5px;
    }
    #centerAddr {
    	display:		block;
    	margin-top:		2px;
    	font-weight:	normal;
    }
    .bAddr {
    	padding:		5px;
    	text-overflow:	ellipsis;
    	overflow:		hidden;
    	white-space:	nowrap;
    }
</style>

<script type="text/javascript">
function nowLocationClick() {
	
	nowLocation();
	
}
</script>
	
	
</head>
<body>

	<div data-role="header" data-position="fixed" data-theme="a">
      <a href="../" data-rel="back" class="ui-btn ui-btn-left ui-alt-icon ui-nodisc-icon ui-corner-all ui-btn-icon-notext ui-icon-carat-l">Back</a>
        <h1>대전 리스트</h1>
    </div>

	<div class="ui-grid-c">
    	<div class="ui-block-a">
    		<div class="ui-body ui-body-d">
    			<label><input name="viewChoice" id="3ball" type="radio" onclick="javascript:3ballMap" value="selected">3구</label>
    		</div>
    	</div>
	    <div class="ui-block-b">
	    	<div class="ui-body ui-body-d">
	    		<label><input name="viewChoice" id="4ball" type="radio">4구</label>
	    	</div>
	    </div>
	    <div class="ui-block-c">
	    	<div class="ui-body ui-body-d">
				<label><input name="viewChoice" id="pocketball" type="radio">포켓볼</label>
	    	</div>
	    </div>
	    <div class="ui-block-d">
	    	<div class="ui-body ui-body-d">
				<label><input name="viewChoice" id="total" type="radio">전체</label>
	    	</div>
	    </div>
	</div><!-- /grid-c -->
	
	<!-- //////////////////////////////////////////////////////////////////////////////////////////// -->
	
<div class="map_wrap">
    <!-- <div id="map" style="width:100%;height:600px;position:relative;overflow:hidden;"></div> -->
    <div id="map" style="width:100%;height:100%;position:relative; overflow:visible"></div>
     <div class="hAddr">
     	<img src="../lib/images/map/location-click.png" onclick="nowLocationClick()">
    </div>
    <div class="rdList">
     	<a href="map_list.html"><img src="../lib/images/home/list.png" width="50px"></a>
    </div>
</div>

<script type="text/javascript" src="//apis.daum.net/maps/maps3.js?apikey=5e4670f48de878e5bf6bd8cddfddb40a&libraries=services"></script>
<script>

var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
    mapOption = {
        center: new daum.maps.LatLng(37.566833, 126.978522), // 지도의 중심좌표
        level: 3 // 지도의 확대 레벨
    };  

// 지도를 생성합니다    
var map = new daum.maps.Map(mapContainer, mapOption); 

// 현재위치를 중심으로 지도 위치 추적
nowLocation();

//////////////////////////////////////현재위치 마커/////////////////////////////////////////////

var lat; //위도
var lon; //경도

var locMarker;

function nowLocation() {
	
 	if(!!locMarker) {
		console.log('이전 locMarker 존재');	
	}
 	
	// 지도에 마커와 인포윈도우를 표시하는 함수입니다
	var imageSrc = '../lib/images/map/red-circle.png', // 마커이미지의 주소입니다    
	imageSize = new daum.maps.Size(25, 25), // 마커이미지의 크기입니다
	imageOption = {
		offset : new daum.maps.Point(10, 10)
	}; // 마커이미지의 옵션입니다. 마커의 좌표와 일치시킬 이미지 안에서의 좌표를 설정합니다.

	// 마커의 이미지정보를 가지고 있는 마커이미지를 생성합니다
	var markerImage = new daum.maps.MarkerImage(imageSrc, imageSize,
			imageOption), markerPosition = new daum.maps.LatLng(lat, lon); // 마커가 표시될 위치입니다

	function displayMarker(locPosition, message) {

		// 마커를 생성합니다
		locMarker = new daum.maps.Marker({
			map : map,
			position : locPosition,
			image : markerImage
		});

		// 지도 중심좌표를 접속위치로 변경합니다
		map.setCenter(locPosition);
	}
	
			
			
	//HTML5의 geolocation으로 사용할 수 있는지 확인합니다 
	if (navigator.geolocation) {

		// GeoLocation을 이용해서 접속 위치를 얻어옵니다
		navigator.geolocation.getCurrentPosition(function(position) {

			lat = position.coords.latitude, // 위도
			lon = position.coords.longitude; // 경도

			var locPosition = new daum.maps.LatLng(lat, lon), // 마커가 표시될 위치를 geolocation으로 얻어온 좌표로 생성합니다
			message = ''; // 인포윈도우에 표시될 내용입니다

			// 마커와 인포윈도우를 표시합니다
			displayMarker(locPosition, message);

		});

	} else { // HTML5의 GeoLocation을 사용할 수 없을때 마커 표시 위치와 인포윈도우 내용을 설정합니다

		var locPosition = new daum.maps.LatLng(33.450701, 126.570667), message = '현재 위치를 확인할 수 없습니다.';

		displayMarker(locPosition, message);
	}
}


// 주소-좌표 변환 객체를 생성합니다
var geocoder = new daum.maps.services.Geocoder();


// 지도를 클릭했을 때 클릭 위치 좌표에 대한 주소정보를 표시하도록 이벤트를 등록합니다
daum.maps.event.addListener(map, 'click', function(mouseEvent) {
    searchDetailAddrFromCoords(mouseEvent.latLng, function(status, result) {
        if (status === daum.maps.services.Status.OK) {              
            console.log(result[0].roadAddress.name);
            console.log(result[0].jibunAddress.name); 
        }   
    });
});



function searchAddrFromCoords(coords, callback) {
    // 좌표로 행정동 주소 정보를 요청합니다
    geocoder.coord2addr(coords, callback);         
}

function searchDetailAddrFromCoords(coords, callback) {
    // 좌표로 법정동 상세 주소 정보를 요청합니다
    geocoder.coord2detailaddr(coords, callback);
}
	

	// 지도 중심 좌표 변화 이벤트를 등록한다
	daum.maps.event.addListener(map, 'center_changed', function() {
		console.log('지도의 중심 좌표 : ' + map.getCenter().toString());
	});
		
		
		// 마커 이미지의 주소
		var redMarkerImageUrl = '../lib/images/map/red-pin.png', 
		markerImageSize = new daum.maps.Size(40, 42), // 마커 이미지의 크기
	    markerImageOptions = { 
			offset : new daum.maps.Point(20, 42)// 마커 좌표에 일치시킬 이미지 안의 좌표
		    };

		var blueMarkerImageUrl = '../lib/images/map/blue-pin.png', 
		markerImageSize = new daum.maps.Size(40, 42), // 마커 이미지의 크기
	    markerImageOptions = { 
			offset : new daum.maps.Point(20, 42)// 마커 좌표에 일치시킬 이미지 안의 좌표
		    };
		
		var greenMarkerImageUrl = '../lib/images/map/green-pin.png', 
		markerImageSize = new daum.maps.Size(40, 42), // 마커 이미지의 크기
	    markerImageOptions = { 
			offset : new daum.maps.Point(20, 42)// 마커 좌표에 일치시킬 이미지 안의 좌표
		    };
		
		// 마커 이미지를 생성한다
		var redMarkerImage = new daum.maps.MarkerImage(redMarkerImageUrl, markerImageSize, markerImageOptions);
		var blueMarkerImage = new daum.maps.MarkerImage(blueMarkerImageUrl, markerImageSize, markerImageOptions);
		var greenMarkerImage = new daum.maps.MarkerImage(greenMarkerImageUrl, markerImageSize, markerImageOptions);
		// 지도에 마커를 생성하고 표시한다
		
		var redMarker = new daum.maps.Marker({
		    position: new daum.maps.LatLng(37.56634, 126.98854), // 마커의 좌표 (추후에 좌표는 DB에서 불어와야 함.)
		    draggable : false, // 마커를 드래그 가능하도록 설정한다
		    image : redMarkerImage, // 마커의 이미지
		    map: map // 마커를 표시할 지도 객체
		});
		
		var blueMarker = new daum.maps.Marker({
		    position: new daum.maps.LatLng(37.56729, 126.98749), // 마커의 좌표
		    draggable : false, // 마커를 드래그 가능하도록 설정한다
		    image : blueMarkerImage, // 마커의 이미지
		    map: map // 마커를 표시할 지도 객체
		});
		
		var greenMarker = new daum.maps.Marker({
		    position: new daum.maps.LatLng(37.56825, 126.98644), // 마커의 좌표
		    draggable : false, // 마커를 드래그 가능하도록 설정한다
		    image : greenMarkerImage, // 마커의 이미지
		    map: map // 마커를 표시할 지도 객체
		});
		// 마커에 클릭 이벤트를 등록한다 (우클릭 : rightclick)
		daum.maps.event.addListener(redMarker, 'click', function() {
		    console.log("레드마커 클릭");
		});
		daum.maps.event.addListener(blueMarker, 'click', function() {
		    console.log("블루마커 클릭");
		});
		daum.maps.event.addListener(greenMarker, 'click', function() {
		    console.log("그린마커 클릭");
		});
		
		
		
		/* 경기리스트 뜨게하는 부분 */
		
		// 마커를 클릭했을 때 마커 위에 표시할 인포윈도우를 생성합니다
		var iwContent = '<div style="padding:5px;">'+
		'<table border=0 cellspacing=0 cellpadding=0 width=100% style="display:block; border:4px solid #E3E3E3;">'+
		'   <tr>	'+
		'      <td align=center valign=top width=20% height=50><br>'+
		'         <img src="../lib/images/home/my.png" />'+
		'      </td>'+
		'      <td align=left width=80%>'+
		'         <br>'+
		'         <table border=0 cellspacing=0 cellpadding=1>'+
		'   '+
		'            <tr>'+
		'               <td width=1 rowspan=5></td>'+
		'               <td align=left valign=middle>'+
		'                        <img src="../lib/images/home/my.png" width="20%"/>'+
		'               </td>'+
		'               <td align=left valign=middle>'+
		'                  <font style="font-family:맑은 고딕, tahoma, Vrinda, 굴림, arial; font-size:9pt; color:#8E8E8E; line-height:120%">'+
		'                     이강민(nickname)'+
		'                  </font>'+
		'               </td>'+
		'            </tr>'+
		'   '+
		'               <tr>'+
		'               <td align=left valign=middle>'+
		'                  '+
		'                     <img src="../lib/images/home/trophy.png" width="20%"/>'+
		'               </td>'+
		'               <td align=left valign=middle>'+
		'                  <font style="font-family:맑은 고딕, tahoma, Vrinda, 굴림, arial; font-size:9pt; color:#8E8E8E; line-height:120%">'+
		'                     2200                '+ 
		'                  </font>'+
		'                        <font style="font-family:맑은 고딕, tahoma, Vrinda, 굴림, arial; font-size:9pt; color:#8E8E8E; line-height:120%">'+
		'                     (승률  50% : 승/무/패)'+
		'                        </font>'+
		'               </td>'+
		'            </tr>'+
		'                '+
		'                '+
		'                <tr>'+
		'               <td align=left valign=middle>'+
		'                  <font style="font-family:맑은 고딕, tahoma, Vrinda, 굴림, arial; font-size:9pt; color:#3E3E3A; line-height:120%">'+
		'                      <!--<img src="../lib/images/home/credibility.png" width="20%"/>-->'+
		'                  </font>'+
		'               </td>'+
		'               <td align=left valign=middle>'+
		'                  <font style="font-family:맑은 고딕, tahoma, Vrinda, 굴림, arial; font-size:9pt; color:#8E8E8E; line-height:120%">'+
		'                     '+
		'                  </font>'+
		'               </td>'+
		'            </tr>'+
		'                '+
		'                '+
		'                '+
		'            <tr>'+
		'               <td align=left valign=middle>'+
		'                  <img src="../lib/images/home/pin.png" width="20%"/>'+
		'               </td>'+
		'               <td align=left valign=middle>'+
		'                  <font style="font-family:맑은 고딕, tahoma, Vrinda, 굴림, arial; font-size:9pt; color:#8E8E8E; line-height:120%">'+
		'                     '+
		'                          서울시 동작구 어딘가?'+
		'                </font>'+
		'               </td>'+
		'            </tr>'+
		''+
		'         </table>'+
		'         <br>'+
		'      </td>'+
		'   </tr>'+
		'</table>'+'</div>', // 인포윈도우에 표출될 내용으로 HTML 문자열이나 document element가 가능합니다
		    iwRemoveable = true; // removeable 속성을 ture 로 설정하면 인포윈도우를 닫을 수 있는 x버튼이 표시됩니다

		// 인포윈도우를 생성합니다
		var infoWindow = new daum.maps.InfoWindow({
		    content : iwContent,
		    removable : iwRemoveable
		});

		// 마커에 클릭이벤트를 등록합니다
		daum.maps.event.addListener(redMarker, 'click', function() {
		      // 마커 위에 인포윈도우를 표시합니다
		      infoWindow.open(map, redMarker);  
		});
		
		
		
	</script>
	
</body>
</html>