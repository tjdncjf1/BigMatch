<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>update</title>
<link rel="stylesheet" href="../lib/jquery.mobile-1.4.5/jquery.mobile-1.4.5.css">
<style>
#title {
	padding-left: 4%;
	padding-right: 4%;
}
#description {
	padding-left: 4%;
	padding-right: 4%;
}
#level {
	padding-left: 4%;
	padding-right: 4%;
}
iframe {
	border: none;
}
.*{
	width:92%;
}
#addrBar {
	padding-left: 4%;
	padding-right: 4%;
}
.ui-field-contain {
	padding-left: 4%;
	padding-right: 4%;
}

#timeBar {
	padding-left: 4%;
	padding-right: 4%;
}

table {
	width: 100%;
}

.ui-field-contain {
	padding-left: 0px;
	padding-right: 0px;
}
</style>
</head>
<body>
	<div data-role="header" data-position="fixed" data-theme="a">
		<a href="../" data-rel="back"
			class="ui-btn ui-btn-left ui-alt-icon ui-nodisc-icon ui-corner-all ui-btn-icon-notext ui-icon-carat-l">Back</a>
		<h1>대전 수정</h1>
	</div>

	<form>
		<div align="center" id="title">
			<label for="textinput-hide" class="ui-hidden-accessible">Title</label>
			<input type="text" name="matchingTitle" id="matchingTitle"
				placeholder="제목을 입력하세요.">
		</div>

		<div align="center">
			<fieldset data-role="controlgroup" data-type="horizontal">
				<!--<legend>종목</legend>-->
				<input type="radio" name="eventType" id="radio-choice-h-2a"	value="THREE"> 
				<label id="ui-one" for="radio-choice-h-2a">3 구</label> 
				<input type="radio"	name="eventType" id="radio-choice-h-2b" value="FOUR"> 
				<label id="ui-two" for="radio-choice-h-2b">4 구</label> 
				<input type="radio" name="eventType" id="radio-choice-h-2c" value="POOL"> 
				<label id="ui-three" for="radio-choice-h-2c">포켓볼</label>
			</fieldset>
		</div>

		<div align="center">
			<fieldset data-role="controlgroup" data-type="horizontal">
				<input type="radio" name="memberCount" id="1-choice-h-2a" value="1"> 
				<label for="1-choice-h-2a">1 : 1</label>
				<input type="radio" name="memberCount" id="1-choice-h-2b" value="2">
				<label for="1-choice-h-2b">2 : 2</label> 
				<input type="radio" name="memberCount" id="1-choice-h-2c" value="3"> 
				<label for="1-choice-h-2c">3 : 3</label>
			</fieldset>
		</div>

		<div id="level" style="width: 92%">
			<select name="level" id="select-choice-a" data-native-menu="false">
				<option id="1st" value="30">30이하</option>
				<option id="2nd" value="50">50</option>
				<option id="3th" value="80">80</option>
				<option id="4th" value="100">100</option>
				<option id="5th" value="120">120</option>
				<option id="6th" value="150">150</option>
				<option id="7th" value="200">200</option>
				<option id="8th" value="250">250</option>
				<option id="9th" value="300">300이상</option>
			</select>
		</div>
		
		<div id="timeBar" style="width: 92%">		
		<table>
			<tr>
				<td>
					<div class="ui-field-contain">
						<select name="selectDay" id="select-custom-1" data-native-menu="false" onchange="changeOption(this.value)">
						<option id="today" value="1">오늘</option>
						<option id="tomorrow" value="2">내일</option>
						</select>
					</div>
				</td>
				<td>
					<div class="ui-field-contain">
						<select name="selectTime" id="select-custom-18"
							data-native-menu="false">
							<option id="able01" value="MID_NIGHT">00시 ~ 03시</option>
							<option id="able02" value="DAWN">03시 ~ 06시</option>
							<option id="able03" value="EARLY_MORNING">06시 ~ 09시</option>
							<option id="able04" value="MORNING">09시 ~ 12시</option>
							<option id="able05" value="AFTERNOON">12시 ~ 15시</option>
							<option id="able06" value="LATE_AFTERNOON">15시 ~ 18시</option>
							<option id="able07" value="EVENING">18시 ~ 21시</option>
							<option id="able08" value="NIGHT">21시 ~ 24시</option>
						</select>
					</div>
				</td>
			</tr>
		</table>
		</div>
		
		<div align="center">
			<a href="#popupMap" data-rel="popup" data-position-to="window"
				class="ui-btn ui-corner-all ui-shadow ui-btn-inline">위치등록</a>
			<div data-role="popup" id="popupMap" data-overlay-theme="a"
				data-theme="a" data-corners="false" data-tolerance="15,15">
				<a href="#" data-rel="back"	class="ui-btn ui-btn-b ui-corner-all ui-shadow ui-btn-a ui-icon-delete 
    			ui-btn-icon-notext ui-btn-right">Close</a>
				<iframe src="registerMap.html" width="90%" height="90%" ></iframe>
			</div>
		</div>
	
		<div id="addrBar" align="center">
			<input type="text" id="regAddr" width="20px" value="" readonly="readonly">
		</div>

<!--------------------------------------------------------------------------------------->

		<div id="description" align="center">
			<textarea cols="40" rows="8" name="description" id="textarea-6" placeholder="간단한 내용을 입력하세요"></textarea>
		</div>

		<div id="input" align="center">
			<input type="submit" id="updateMatch" data-inline="true" value="수정하기!">
		</div>
	</form>

<script src="../lib/jquery/jquery.js"></script>
<script src="../lib/jquery.mobile-1.4.5/jquery.mobile-1.4.5.js"></script>
<!-- 공통 자바스크립트 -->
<script src="../lib/js/common.js" ></script> 
<!-- 팝업 -->
<script src="../lib/js/popup.js" ></script>
<!-- <script type="text/javascript" src="//apis.daum.net/maps/maps3.js?apikey=6b3b4d0c9762531403442ab0ac98dd84&libraries=services"></script>다음 로그인 조민호 -->
<!-- <script type="text/javascript" src="//apis.daum.net/maps/maps3.js?apikey=35281aceab086c0a7cccadc0b4963623&libraries=services"></script> --> <!-- 카카오톡 로그인 서우철 -->
<script type="text/javascript" src="//apis.daum.net/maps/maps3.js?apikey=5e4670f48de878e5bf6bd8cddfddb40a&libraries=services"></script><!-- 다음 로그인 임현우 -->
<!-- <script type="text/javascript" src="//apis.daum.net/maps/maps3.js?apikey=9080e1a934aab4b455f480ca93a0c7f5&libraries=services"></script> --> <!--다음 로그인 정승택 -->
<script type="text/javascript">
	
	var addLat = ''; // 위도  
	var addLng = ''; // 경도
	var addLoc = ''; // 주소
	
	//popup창 close function()
	function popupClose(lat, lng, loc) {
	
		addLat = lat;
		addLng = lng;
		addLoc = loc;
	
		console.log('위도 :: ' + addLat);
		console.log('경도 :: ' + addLng);
		console.log('주소 :: ' + addLoc);
		
		$('#regAddr').val(addLoc);		// 주소 등록. 
		$('#popupMap').popup('close');	// 팝업창 close
	}
		
	changeOption(1);
	
	function changeOption(value) {
			
		if(value == '1') {
					
	 		console.log('1도착');
	 		
	 		var now = new Date().getHours();
	 		
	 		if( now > 2) {
	 			$('#able01').attr("disabled","disabled");
	 		}
	 		if( now > 5) {
	 			$('#able02').attr("disabled","disabled");
	 		}
	 		if( now > 8) {
	 			$('#able03').attr("disabled","disabled");
	 		}
	 		if( now > 11) {
	 			$('#able04').attr("disabled","disabled");
	 		}
	 		if( now > 14) {
	 			$('#able05').attr("disabled","disabled");
	 		}
	 		if( now > 17) {
	 			$('#able06').attr("disabled","disabled");
	 		}
	 		if( now > 20) {
	 			$('#able07').attr("disabled","disabled");
	 		}
	 		if( now > 23) {
	 			$('#able08').attr("disabled","disabled");
	 		}
	 		
	 		if( now > 2) {
	 			$('#select-custom-18-menu [data-option-index=0]').addClass('ui-state-disabled');
	 		}
	 		if( now > 5) {
	 			$('#select-custom-18-menu [data-option-index=1]').addClass('ui-state-disabled');
	 		}
	 		if( now > 8) {
	 			$('#select-custom-18-menu [data-option-index=2]').addClass('ui-state-disabled');
	 		}
	 		if( now > 11) {
	 			$('#select-custom-18-menu [data-option-index=3]').addClass('ui-state-disabled');
	 		}
	 		if( now > 14) {
	 			$('#select-custom-18-menu [data-option-index=4]').addClass('ui-state-disabled');
	 		}
	 		if( now > 17) {
	 			$('#select-custom-18-menu [data-option-index=5]').addClass('ui-state-disabled');
	 		}
	 		if( now > 20) {
	 			$('#select-custom-18-menu [data-option-index=6]').addClass('ui-state-disabled');
	 		}
	 		if( now > 23) {
	 			$('#select-custom-18-menu [data-option-index=7]').addClass('ui-state-disabled');
	 		}	 				
		}
		
		if(value == '2') {
			$('ul>li').removeClass();
		}
		
	};
	
	var matchingSeq = Number(location.href.split('?')[1].split('=')[1]);
	console.log("matchingSeq :: " + matchingSeq);
	
	$.ajax({
		url			: baseUrl + '/matchDetail.do/' + matchingSeq,
		type		: 'GET',
		headers		: { 
			"Accept" : "application/json",
			"Content-Type" : "application/json"
  		},
  		success		: function(result) {
  			
			console.log(result);
			$('input[name=matchingTitle]').val(result.matchingTitle);
			$('input:radio[name=eventType]:radio[value="'+result.eventTypeCd+'"]').attr('checked', true);
			$('input:radio[name=eventType]:radio[value="'+result.eventTypeCd+'"]').parent().children('label').removeClass();
			$('input:radio[name=eventType]:radio[value="'+result.eventTypeCd+'"]').parent().children('label').addClass('ui-btn ui-corner-all ui-btn-inherit ui-btn-active ui-radio-on');
			$('input:radio[name=memberCount]:radio[value="'+result.memberCount+'"]').attr('checked', true);
			$('input:radio[name=memberCount]:radio[value="'+result.memberCount+'"]').parent().children('label').removeClass();
			$('input:radio[name=memberCount]:radio[value="'+result.memberCount+'"]').parent().children('label').addClass('ui-btn ui-corner-all ui-btn-inherit ui-btn-active ui-radio-on');
			$('select[name=level]').val(result.targetStartLevel);
			if(result.targetStartLevel=='300') {
				$('select[name=level]').parent().children().children().html(result.targetStartLevel+'이상');
				resetOption();
			} else if (result.targetStartLevel=='30') {
				$('select[name=level]').parent().children().children().html(result.targetStartLevel+'이하');
				resetOption();
			} else {
				$('select[name=level]').parent().children().children().html(result.targetStartLevel);
				resetOption();
			}
			
			
			function resetOption() {
				$('#1st').html('30이하');
				$('#2nd').html('50');
				$('#3th').html('80');
				$('#4th').html('100');
				$('#5th').html('120');
				$('#6th').html('150');
				$('#7th').html('200');
				$('#8th').html('250');
				$('#9th').html('300이상');
				$('#today').html('오늘');
				$('#tomorrow').html('내일');
				$('#able01').html('00시 ~ 03시');
				$('#able02').html('03시 ~ 06시');
				$('#able03').html('06시 ~ 09시');
				$('#able04').html('09시 ~ 12시');
				$('#able05').html('12시 ~ 15시');
				$('#able06').html('15시 ~ 18시');
				$('#able07').html('18시 ~ 21시');
				$('#able08').html('21시 ~ 24시');
			}
			
			$('input[name=selectTime]').val(result.timeCd);
			switch(result.timeCd) {
				case 'MID_NIGHT' :
					$('select[name=selectTime]').parent().children().children().html('00시 ~ 03시');
					resetOption();
					break;
				case 'DAWN' :
					$('select[name=selectTime]').parent().children().children().html('03시 ~ 06시');
					resetOption();
					break;
				case 'EARLY_MORNING' :
					$('select[name=selectTime]').parent().children().children().html('06시 ~ 09시');
					resetOption();
					break;
				case 'MORNING' :
					$('select[name=selectTime]').parent().children().children().html('09시 ~ 12시');
					resetOption();
					break;
				case 'AFTERNOON' :
					$('select[name=selectTime]').parent().children().children().html('12시 ~ 15시');
					resetOption();
					break;
				case 'LATE_AFTERNOON' :
					$('select[name=selectTime]').parent().children().children().html('15시 ~ 18시');
					resetOption();
					break;
				case 'EVENING' :
					$('select[name=selectTime]').parent().children().children().html('18시 ~ 21시');
					resetOption();
					break;
				case 'NIGHT' :
					$('select[name=selectTime]').parent().children().children().html('21시 ~ 24시');
					resetOption();
					break;
			}

			if( result.date == new Date().getDate() ) {
				console.log("오늘 등록");
				$('input[name=selectDay]').val("1");
				$('select[name=selectDay]').parent().children().children().html('오늘');
				
				resetOption();
			} else {
				console.log("내일 등록");
				$('input[name=selectDay]').val("2");
				$('select[name=selectDay]').parent().children().children().html('내일');
				
				resetOption();
			}
		
			var addr;
			var latV = Number(result.placeLatitude);
			var lonV = Number(result.placeLongitude);
			var geocoder = new daum.maps.services.Geocoder();
			var coord = new daum.maps.LatLng(latV, lonV);
			var callback = function(status, result) {
			    if (status === daum.maps.services.Status.OK) {
			        console.log('지번 주소 : ' + result[0].jibunAddress.name);
			        addr = result[0].jibunAddress.name;
			        $('#regAddr').val(addr);
			    }
			};
			geocoder.coord2detailaddr(coord, callback);
			
			$('textarea[name=description]').val(result.matchingDesc);
		
			$('form').bind('submit', function(event) {
				event.preventDefault(); // 디폴트 이벤트 제거
				
				var updateYear = '';
				var updateMonth = '';
				var updateDay = '';
				var now = new Date();
				var tomorrow = new Date(now.valueOf() + (24*60*60*1000));	
				
				if (($('select[name="selectDay"]').val())=='1') {
					console.log('1');
					updateYear = now.getFullYear();
					updateMonth = now.getMonth() + 1;
					updateDay = now.getDate();
				} else {
					console.log('2');
					updateYear = tomorrow.getFullYear();
					updateMonth = tomorrow.getMonth() + 1;
					updateDay = tomorrow.getDate();
				}
				
				$.ajax({
					url		 : baseUrl + '/matchDetail.do/' + matchingSeq,
					type	 : 'PUT',
					dataType : 'JSON',
					headers	 : { 
						"Accept" : "application/json",
			  			"Content-Type" : "application/json"
			  		},
			  		data	 : JSON.stringify({
			  			hostUserSeq			: localStorage.getItem('userseq'),
			  			matchingTitle		: $('#matchingTitle').val(),
						eventTypeCd			: $('input[name="eventType"]:checked:checked').val(),
						memberCount			: $('input[name="memberCount"]:checked:checked').val(),
						targetStartLevel	: $('select[name="level"]').val(),
						year				: updateYear,
						month				: updateMonth,
						date				: updateDay,
						timeCd				: $('select[name="selectTime"]').val(),
						matchingDesc		: $('#textarea-6').val(),
						placeLatitude		: addLat,
						placeLongitude		: addLng
			  		}),
			  		success		: function(result) {
						console.log(result);
					}
				});
			});	
  		}
	});
	
	
	
		
</script>
</body>
</html>